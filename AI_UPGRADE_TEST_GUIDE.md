# 🧪 AI 护理排班系统 - 完整 AI 测试指南

## 🚀 快速开始

### 步骤 1：刷新浏览器 ⚡
```
按 Ctrl + Shift + R（强制刷新，清除缓存）
```

### 步骤 2：打开开发者工具 🔧
```
按 F12 打开 Console
```

### 步骤 3：登录系统 👤
- 使用 **fenghospital** 账户登录
- 进入 **「AI 护理排班」** 模块

---

## 🧪 测试 1：AI 智能优化

### 操作步骤：
1. 在 AI 护理排班页面
2. 点击右上角的 **「AI 智能优化」** 按钮
3. 等待几秒钟

### ✅ 预期结果：

#### Console 输出（F12）：
```javascript
🤖 調用 AI 排班優化... {companyId: "...", periodStart: "2025-10-18", ...}
✅ AI 優化結果: {
  data: {
    scheduled_count: 3,
    conflicts: [],
    suggestions: [...],
    metrics: {
      coverage_rate: 0.95,
      satisfaction_score: 0.87
    }
  }
}
```

#### 弹窗消息：
```
🤖 AI 智能排班優化完成！

✅ 成功排班: X 個班次
⚠️ 發現衝突: X 個 (如有)

💡 AI 建議:
  • 建議1
  • 建議2
  • 建議3

📊 優化指標:
  • 覆蓋率: 95.5%
  • 滿意度: 87.2%
```

### ❌ 如果出错：

**错误 1：CORS 错误**
```
Access to fetch blocked by CORS policy
```
**解决：** Edge Function 未部署或配置错误

**错误 2：404 错误**
```
POST .../nursing-schedule-ai 404
```
**解决：** Edge Function 名称错误或未部署

**错误 3：401 未授权**
```
401 Unauthorized
```
**解决：** 登录过期，请重新登录

---

## 🧪 测试 2：工作量预测

### 操作步骤：
1. 在 AI 护理排班页面
2. 点击 **「预测工作量」** 按钮
3. 等待几秒钟

### ✅ 预期结果：

#### Console 输出（F12）：
```javascript
📊 調用 AI 工作量預測... {companyId: "...", wardId: null, ...}
✅ AI 預測結果: {
  data: [
    {
      prediction_date: "2025-10-18",
      predicted_patient_count: 45,
      required_staff_count: 8,
      estimated_workload: 78.5
    },
    ...
  ]
}
```

#### 弹窗消息：
```
📊 AI 工作量預測完成！

預測期間: 7 天

📅 2025-10-18
  患者數: 45
  所需人力: 8 人
  工作量: 78.5

📅 2025-10-19
  患者數: 52
  所需人力: 9 人
  工作量: 85.3

...
```

---

## 🧪 测试 3：验证数据更新

### 操作步骤：
1. 执行 AI 优化后
2. 查看排班列表

### ✅ 预期结果：
- 原本「待排班」的班次变为「已排班」
- 显示分配的护理人员姓名
- 统计卡片数字更新

---

## 📋 完整测试清单

### 基础功能 ✓
- [ ] 页面正常加载
- [ ] 显示护理人员列表（7-8人）
- [ ] 显示病房信息（5个）
- [ ] 显示统计卡片

### AI 优化功能 ✓
- [ ] 点击「AI 智能优化」按钮无错误
- [ ] Console 显示 `🤖 調用 AI 排班優化...`
- [ ] Console 显示 `✅ AI 優化結果:`
- [ ] 弹窗显示成功排班数量
- [ ] 弹窗显示 AI 建议（如有）
- [ ] 弹窗显示优化指标
- [ ] 排班列表自动更新

### 工作量预测 ✓
- [ ] 点击「预测工作量」按钮无错误
- [ ] Console 显示 `📊 調用 AI 工作量預測...`
- [ ] Console 显示 `✅ AI 預測結果:`
- [ ] 弹窗显示预测天数（7天）
- [ ] 弹窗显示每日预测数据
- [ ] 显示患者数、人力、工作量

### Console 检查 ✓
- [ ] 无 404 错误
- [ ] 无 CORS 错误
- [ ] 无 TypeScript 错误
- [ ] API 调用成功（200 OK）

---

## 🐛 常见问题排查

### 问题 1：点击按钮没有反应
**检查：**
1. 是否已登录？
2. Console 有无错误？
3. 网络请求是否发出？

### 问题 2：显示「API 錯誤」
**检查：**
1. Edge Function 是否部署？
2. Supabase URL 是否正确？
3. 认证 token 是否有效？

### 问题 3：显示「請先登入」
**解决：**
- 退出登录
- 重新使用 fenghospital 账户登录

### 问题 4：Edge Function 返回 500
**检查：**
1. 数据库表是否存在？
2. 是否有待排班次？
3. 是否有可用护理人员？

---

## 📊 性能指标

### API 响应时间
- **优化排班：** 2-5 秒
- **工作量预测：** 1-3 秒

### 数据处理
- **评估候选人：** 每个班次 ~100ms
- **冲突检测：** 每个候选人 ~50ms
- **评分计算：** 实时

---

## 🎯 成功标准

### ✅ 升级成功的标志：
1. ✅ 点击按钮后 API 正常调用
2. ✅ Console 显示完整的请求和响应
3. ✅ 弹窗显示详细的 AI 结果
4. ✅ 包含评分、建议、指标
5. ✅ 数据自动更新
6. ✅ 无任何错误

### ❌ 需要修复的标志：
1. ❌ 404 或 CORS 错误
2. ❌ 弹窗只显示简单消息
3. ❌ 没有 AI 建议或指标
4. ❌ Console 有 TypeScript 错误
5. ❌ 数据不更新

---

## 🔍 调试技巧

### 查看完整 API 请求：
```javascript
// 在 Console 输入：
// 会在 optimizeSchedule 执行时看到完整日志
```

### 查看 Edge Function 日志：
1. 进入 Supabase Dashboard
2. Edge Functions > nursing-schedule-ai
3. 点击「Logs」标签
4. 查看实时日志

### 查看网络请求：
1. F12 > Network 标签
2. 过滤：nursing-schedule-ai
3. 查看请求和响应详情

---

## 📞 报告问题

### 需要提供的信息：
1. 截图或复制 Console 错误
2. 截图弹窗消息
3. 描述操作步骤
4. 当前使用的账户

---

**准备好了吗？开始测试吧！** 🚀

刷新浏览器（Ctrl + Shift + R）→ 登录 → 测试 AI 功能！



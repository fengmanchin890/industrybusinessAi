# AI è—¥ç‰©ç®¡ç†ç³»çµ± - è¨­ç½®æŒ‡å—

## âŒ ç•¶å‰éŒ¯èª¤
```
Could not find the table 'public.medications' in the schema cache
```

é€™è¡¨ç¤ºæ•¸æ“šåº«è¡¨å°šæœªå‰µå»ºã€‚è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿè¨­ç½®ã€‚

---

## ğŸ“‹ å¿«é€Ÿè¨­ç½®æ­¥é©Ÿ

### æ–¹æ³• 1ï¼šä½¿ç”¨ Supabase Dashboardï¼ˆæ¨è–¦ï¼Œæœ€ç°¡å–®ï¼‰

1. **æ‰“é–‹ Supabase Dashboard**
   - å‰å¾€ï¼šhttps://supabase.com/dashboard
   - é¸æ“‡æ‚¨çš„å°ˆæ¡ˆï¼š`ergqqdirsvmamowpklia`

2. **é‹è¡Œ Migration SQL**
   - é»æ“Šå·¦å´èœå–® **SQL Editor**
   - é»æ“Š **New Query**
   - è¤‡è£½ä¸¦è²¼ä¸Šæ•´å€‹æª”æ¡ˆå…§å®¹ï¼š
     ```
     supabase/migrations/20251018100000_add_drug_management_tables.sql
     ```
   - é»æ“Š **Run** åŸ·è¡Œ

3. **é©—è­‰è¡¨æ ¼å·²å‰µå»º**
   - é»æ“Šå·¦å´èœå–® **Table Editor**
   - æ‡‰è©²çœ‹åˆ°ä»¥ä¸‹æ–°è¡¨ï¼š
     - âœ… `medications` (è—¥ç‰©è³‡æ–™åº«)
     - âœ… `drug_interactions` (è—¥ç‰©äº¤äº’ä½œç”¨)
     - âœ… `prescriptions` (è™•æ–¹è¨˜éŒ„)
     - âœ… `prescription_items` (è™•æ–¹æ˜ç´°)
     - âœ… `patient_allergies` (ç—…æ‚£éæ•è¨˜éŒ„)
     - âœ… `drug_interaction_checks` (AI æª¢æŸ¥è¨˜éŒ„)

4. **å°å…¥ç¨®å­æ•¸æ“šï¼ˆå¯é¸ä½†æ¨è–¦ï¼‰**
   åœ¨ SQL Editor ä¸­å†æ¬¡æ–°å¢æŸ¥è©¢ï¼Œé‹è¡Œï¼š
   ```sql
   -- å°‡åœ¨ä¸‹æ–¹æä¾›å®Œæ•´çš„ç¨®å­æ•¸æ“š SQL
   ```

5. **é‡æ–°æ•´ç†ç¶²é æ‡‰ç”¨**
   - å›åˆ°æ‚¨çš„æ‡‰ç”¨
   - æŒ‰ `Ctrl+Shift+R` (æˆ– `Cmd+Shift+R`) å¼·åˆ¶é‡æ–°æ•´ç†
   - å†æ¬¡æœå°‹è—¥ç‰©ï¼Œæ‡‰è©²å°±èƒ½æ­£å¸¸é‹ä½œäº†ï¼

---

### æ–¹æ³• 2ï¼šä½¿ç”¨ Supabase CLIï¼ˆé€²éšï¼‰

å¦‚æœæ‚¨å·²å®‰è£ Supabase CLIï¼š

```bash
# 1. ç¢ºä¿å·²ç™»å…¥
supabase login

# 2. é€£çµåˆ°æ‚¨çš„å°ˆæ¡ˆ
supabase link --project-ref ergqqdirsvmamowpklia

# 3. æ¨é€ migration
supabase db push

# 4. å°å…¥ç¨®å­æ•¸æ“š
node scripts/seed-medications.js
```

**æ³¨æ„ï¼š** éœ€è¦è¨­ç½®ç’°å¢ƒè®Šæ•¸ï¼š
```bash
# .env.local
VITE_SUPABASE_URL=https://ergqqdirsvmamowpklia.supabase.co
SUPABASE_SERVICE_KEY=your_service_role_key
```

---

## ğŸ—ƒï¸ æ•¸æ“šåº«æ¶æ§‹æ¦‚è¦½

å·²å‰µå»ºçš„è¡¨æ ¼ï¼š

### 1. `medications` - è—¥ç‰©è³‡æ–™åº«
- è—¥ç‰©åŸºæœ¬ä¿¡æ¯ï¼ˆåç¨±ã€æˆåˆ†ã€åŠ‘å‹ï¼‰
- ç”¨è—¥æŒ‡å¼•ï¼ˆåŠ‘é‡ã€é »ç‡ã€çµ¦è—¥é€”å¾‘ï¼‰
- å®‰å…¨ä¿¡æ¯ï¼ˆç¦å¿Œç—‡ã€è­¦å‘Šã€å‰¯ä½œç”¨ï¼‰
- å¥ä¿ä¿¡æ¯

### 2. `drug_interactions` - è—¥ç‰©äº¤äº’ä½œç”¨
- äº¤äº’ä½œç”¨åš´é‡ç¨‹åº¦ï¼ˆminor/moderate/major/contraindicatedï¼‰
- è‡¨åºŠæ•ˆæœå’Œè™•ç†å»ºè­°
- ä½œç”¨æ©Ÿè½‰

### 3. `prescriptions` - è™•æ–¹è¨˜éŒ„
- è™•æ–¹åŸºæœ¬ä¿¡æ¯
- é†«å¸«ä¿¡æ¯
- å¯©æ ¸ç‹€æ…‹

### 4. `prescription_items` - è™•æ–¹æ˜ç´°
- ç”¨è—¥è©³æƒ…ï¼ˆåŠ‘é‡ã€é »ç‡ã€ç™‚ç¨‹ï¼‰
- é ˜è—¥è¨˜éŒ„

### 5. `patient_allergies` - ç—…æ‚£éæ•è¨˜éŒ„
- éæ•æºé¡å‹
- åæ‡‰åš´é‡ç¨‹åº¦
- ç—‡ç‹€æè¿°

### 6. `drug_interaction_checks` - AI æª¢æŸ¥è¨˜éŒ„
- AI åˆ†æçµæœ
- é¢¨éšªè©•åˆ†
- è‡¨åºŠè­¦ç¤ºå’Œå»ºè­°

---

## ğŸ¤– AI åŠŸèƒ½ï¼ˆå¯é¸å¢å¼·ï¼‰

### å•Ÿç”¨ OpenAI é›†æˆ

å¦‚æœæ‚¨æƒ³ä½¿ç”¨çœŸæ­£çš„ AI åˆ†æï¼ˆGPT-4ï¼‰ï¼Œéœ€è¦ï¼š

1. **å–å¾— OpenAI API Key**
   - å‰å¾€ï¼šhttps://platform.openai.com/api-keys
   - å‰µå»ºæ–°çš„ API Key

2. **åœ¨ Supabase è¨­ç½® Secrets**
   ```bash
   supabase secrets set OPENAI_API_KEY=sk-your-key-here
   ```

3. **éƒ¨ç½² Edge Function**
   ```bash
   supabase functions deploy drug-interaction-checker
   ```

**ä¸è¨­ç½®ä¹Ÿå¯ä»¥ï¼** ç³»çµ±æœƒè‡ªå‹•ä½¿ç”¨è³‡æ–™åº«çš„äº¤äº’ä½œç”¨æ•¸æ“šï¼Œä»ç„¶éå¸¸å¯¦ç”¨ã€‚

---

## âœ… é©—è­‰è¨­ç½®

é‹è¡Œå¾Œï¼Œæ‚¨æ‡‰è©²èƒ½å¤ ï¼š

1. âœ… æœå°‹è—¥ç‰©ï¼ˆè¼¸å…¥ 2 å€‹å­—å…ƒå¾Œé–‹å§‹æœå°‹ï¼‰
2. âœ… æ·»åŠ è—¥ç‰©åˆ°ç—…æ‚£ç”¨è—¥æ¸…å–®
3. âœ… åŸ·è¡Œ AI äº¤äº’ä½œç”¨æª¢æŸ¥
4. âœ… æŸ¥çœ‹é¢¨éšªè©•ä¼°å’Œå»ºè­°
5. âœ… ç”Ÿæˆç”¨è—¥å®‰å…¨å ±å‘Š

---

## ğŸ†˜ å¸¸è¦‹å•é¡Œ

### Q: é‚„æ˜¯çœ‹åˆ° 404 éŒ¯èª¤ï¼Ÿ
A: 
1. ç¢ºèªå·²åœ¨ Supabase Dashboard åŸ·è¡Œ migration
2. æª¢æŸ¥ Table Editor ä¸­æ˜¯å¦æœ‰ `medications` è¡¨
3. å˜—è©¦é‡æ–°æ•´ç† Supabase API schema cacheï¼š
   - Dashboard â†’ Settings â†’ API â†’ Reload schema cache

### Q: è¡¨æ ¼æ˜¯ç©ºçš„ï¼Œæ²’æœ‰è—¥ç‰©å¯æœå°‹ï¼Ÿ
A: éœ€è¦å°å…¥ç¨®å­æ•¸æ“šï¼ˆè¦‹ä¸‹æ–¹ SQLï¼‰

### Q: æƒ³è¦æ›´å¤šè—¥ç‰©ï¼Ÿ
A: å¯ä»¥åœ¨ SQL Editor ä¸­æ‰‹å‹•æ’å…¥ï¼Œæˆ–ä¿®æ”¹ `scripts/seed-medications.js` æ·»åŠ æ›´å¤šè—¥ç‰©

---

## ğŸ“ æ¥ä¸‹ä¾†çš„æ­¥é©Ÿ

è¨­ç½®å®Œæˆå¾Œï¼Œæ‚¨å¯ä»¥ï¼š

1. **æ¸¬è©¦åŠŸèƒ½**
   - æœå°‹ "é˜¿æ–¯åŒ¹éˆ" æˆ– "Aspirin"
   - æ·»åŠ å¤šç¨®è—¥ç‰©
   - åŸ·è¡Œäº¤äº’ä½œç”¨æª¢æŸ¥

2. **æŸ¥çœ‹å…¶ä»–æ¨¡çµ„**
   - AI ç—…æ­·åˆ†æ
   - è­·ç†æ’ç­
   - å¥åº·ç›£æ¸¬

3. **è‡ªè¨‚è—¥ç‰©è³‡æ–™åº«**
   - æ·»åŠ æ‚¨é†«é™¢å¸¸ç”¨çš„è—¥ç‰©
   - æ›´æ–°äº¤äº’ä½œç”¨è³‡æ–™

---

## ğŸ¯ ç•¶å‰ç³»çµ±æ¶æ§‹

```
âœ… å‰ç«¯çµ„ä»¶
â”œâ”€â”€ DrugManagement.tsx (æ–°ç‰ˆï¼Œé€£æ¥çœŸå¯¦ API)
â””â”€â”€ DrugInteractionChecker.tsx (èˆŠç‰ˆï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š)

â³ æ•¸æ“šåº« (éœ€è¦è¨­ç½®)
â”œâ”€â”€ medications (è—¥ç‰©è³‡æ–™åº«)
â”œâ”€â”€ drug_interactions (äº¤äº’ä½œç”¨)
â”œâ”€â”€ prescriptions (è™•æ–¹)
â”œâ”€â”€ prescription_items (è™•æ–¹æ˜ç´°)
â”œâ”€â”€ patient_allergies (éæ•è¨˜éŒ„)
â””â”€â”€ drug_interaction_checks (æª¢æŸ¥è¨˜éŒ„)

â³ Edge Functions (å¯é¸)
â”œâ”€â”€ drug-interaction-checker (AI åˆ†æ)
â””â”€â”€ drug-search (æ™ºèƒ½æœå°‹)

âœ… Migration Files
â”œâ”€â”€ 20251018100000_add_drug_management_tables.sql
â””â”€â”€ seed-medications.js
```

---

éœ€è¦å¹«åŠ©ï¼Ÿè«‹å‘Šè¨´æˆ‘ï¼

